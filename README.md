# SettlementAgent

–ö–æ–Ω—Ç—Ä–∞–∫—Ç –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –∏ —É–ø—Ä–∞–≤–ª—è–µ–º–æ–≥–æ —Å–ø–∏—Å–∞–Ω–∏—è —Å—Ä–µ–¥—Å—Ç–≤ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –Ω–∞ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π settlement-–∞–¥—Ä–µ—Å —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ª–∏–º–∏—Ç–æ–≤ –∏ –∫–æ–º–∏—Å—Å–∏–π.

---

## üì¶ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∞–Ω–∏—è —Å—Ä–µ–¥—Å—Ç–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–¥–ø–∏—Å–∫–∏, custody-—Å–µ—Ä–≤–∏—Å—ã, —Å–µ—Ä–≤–∏—Å–Ω—ã–µ —Å–±–æ—Ä—ã) –ø—Ä–∏ –ø–æ–ª–Ω–æ–º –∫–æ–Ω—Ç—Ä–æ–ª–µ –∫–ª–∏–µ–Ω—Ç–∞ –Ω–∞–¥ –ª–∏–º–∏—Ç–∞–º–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è–º–∏.

---

## üõ°Ô∏è –†–æ–ª–∏ –∏ –¥–æ—Å—Ç—É–ø

| –†–æ–ª—å              | –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ |
|-------------------|-------------|
| **Admin** (`ADMIN_ROLE`)          | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ (UUPS), –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–¥—Ä–µ—Å–æ–≤ –∏ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –∫–æ–º–∏—Å—Å–∏–∏ |
| **Manager** (`MANAGER_ROLE`)      | –°–æ–≤–µ—Ä—à–µ–Ω–∏–µ —Å–ø–∏—Å–∞–Ω–∏–π –≤ —Ä–∞–º–∫–∞—Ö –ª–∏–º–∏—Ç–æ–≤ |
| **FeeManager** (`FEEMANAGER_ROLE`) | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–º–∏ —É—Å–ª–æ–≤–∏—è–º–∏ –∫–æ–º–∏—Å—Å–∏–∏ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤ |

---

## üí∞ –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å–ø–∏—Å–∞–Ω–∏—è

–í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ `withdrawFromClient(address client, uint256 amount, uint256 fee)`:

- –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
  - —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–∞–Ω–µ–µ –≤—ã–∑—ã–≤–∞–ª `allowLimit()` –Ω–∞ —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞
  - –ª–∏–º–∏—Ç—ã –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∏ —Å—É–º–º–µ
  - —á—Ç–æ `fee <= –¥–æ–ø—É—Å—Ç–∏–º—ã–π %` –¥–ª—è —ç—Ç–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
- –≤—ã–ø–æ–ª–Ω—è–µ—Ç –¥–≤–∞ –ø–µ—Ä–µ–≤–æ–¥–∞:
  - `amount` ‚Üí –Ω–∞ settlement-–∞–¥—Ä–µ—Å
  - `fee` ‚Üí –Ω–∞ fee-–∞–¥—Ä–µ—Å
- –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ `DetailedWithdrawal`

---

## ‚è≥ –õ–∏–º–∏—Ç—ã

–ö–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –∑–∞–¥–∞—Ç—å:
- `limit10min`: –ª–∏–º–∏—Ç —Å–ø–∏—Å–∞–Ω–∏—è –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –º–∏–Ω—É—Ç
- `limit24h`: –ª–∏–º–∏—Ç —Å–ø–∏—Å–∞–Ω–∏—è –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞

---

## üîê –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –∫–æ–º–∏—Å—Å–∏–∏

–ö–æ–Ω—Ç—Ä–∞–∫—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç:

- –≥–ª–æ–±–∞–ª—å–Ω—É—é –∫–æ–º–∏—Å—Å–∏—é `feePercent` (–Ω–∞–ø—Ä–∏–º–µ—Ä, 2% = 200)
- –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –∫–æ–º–∏—Å—Å–∏–∏ —á–µ—Ä–µ–∑ `customFeePercent[address]`
  - –Ω–µ –º–æ–≥—É—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—É—é –∫–æ–º–∏—Å—Å–∏—é
- –º–µ—Ç–æ–¥ –ø–æ–ª—É—á–µ–Ω–∏—è —É—Å–ª–æ–≤–∏–π –∫–ª–∏–µ–Ω—Ç–∞:

```solidity
function getClientFullInfo(address client) returns (
  uint256 limit10min,
  uint256 limit24h,
  uint256 usedGlobal,
  uint256 allowance,
  uint256 feePercent,
  address settlement,
  address feeAddress
)
