# SettlementAgent: –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏

## üìò –í–≤–µ–¥–µ–Ω–∏–µ

`SettlementAgent` ‚Äî —ç—Ç–æ —É–º–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç, —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∞–Ω–∏—è —Å—Ä–µ–¥—Å—Ç–≤ —Å –∫–æ—à–µ–ª—å–∫–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ –∑–∞–¥–∞–Ω–Ω—ã–º –ø—Ä–∞–≤–∏–ª–∞–º –∏ –ª–∏–º–∏—Ç–∞–º. –ö–æ–Ω—Ç—Ä–∞–∫—Ç –Ω–µ –æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–∞—Å—Ç–æ–¥–∏–∞–ª—å–Ω—ã—Ö —É—Å–ª—É–≥ ‚Äî —Å—Ä–µ–¥—Å—Ç–≤–∞ –≤—Å–µ–≥–¥–∞ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –ø–æ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∞ —Å–ø–∏—Å–∞–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –µ–≥–æ —è–≤–Ω–æ–≥–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è.

---

## üîê –ú–µ—Ö–∞–Ω–∏–∑–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

–ö–æ–Ω—Ç—Ä–∞–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —É—Ä–æ–≤–Ω–µ–π –∑–∞—â–∏—Ç—ã –æ—Ç –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π:

- **–†–æ–ª–µ–≤–æ–π –¥–æ—Å—Ç—É–ø:** —Ç–æ–ª—å–∫–æ –∞–¥—Ä–µ—Å–∞ —Å —Ä–æ–ª—å—é `MANAGER_ROLE` –º–æ–≥—É—Ç –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞—Ç—å —Å–ø–∏—Å–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤.
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤:** –∫–∞–∂–¥—ã–π –ø–µ—Ä–µ–≤–æ–¥ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –¥–Ω–µ–≤–Ω—ã–º, 10-–º–∏–Ω—É—Ç–Ω—ã–º –∏ –≥–ª–æ–±–∞–ª—å–Ω—ã–º –ª–∏–º–∏—Ç–∞–º.
- **–ö–æ–Ω—Ç—Ä–æ–ª—å –∫–æ–º–∏—Å—Å–∏–∏:** –∫–æ–º–∏—Å—Å–∏—è –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –º–∞–∫—Å–∏–º—É–º.
- **–í–µ—Ä—Å–∏–æ–Ω–Ω–æ—Å—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è:** –∫–ª–∏–µ–Ω—Ç —è–≤–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç —Ä–∞–±–æ—Ç—É —Ç–æ–ª—å–∫–æ —Å —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–µ–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞.
- **–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π settlement-–∞–¥—Ä–µ—Å:** –æ–Ω –∑–∞–¥–∞—ë—Ç—Å—è –ø—Ä–∏ –¥–µ–ø–ª–æ–µ –∏ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–∑–º–µ–Ω—ë–Ω.

---

## ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–º

–ü–µ—Ä–µ–¥ —Å–ø–∏—Å–∞–Ω–∏–µ–º —Å—Ä–µ–¥—Å—Ç–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –≤—ã–∑–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `allowLimit()`:

- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≥–ª–æ–±–∞–ª—å–Ω—ã–π –ª–∏–º–∏—Ç, —Ä–∞–≤–Ω—ã–π —Ç–µ–∫—É—â–µ–º—É `approve` –≤ ERC20 —Ç–æ–∫–µ–Ω–µ.
- –§–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –≤–µ—Ä—Å–∏—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞, –Ω–∞ –∫–æ—Ç–æ—Ä—É—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–∞–ª —Å–æ–≥–ª–∞—Å–∏–µ.

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:

- –ú–µ–Ω–µ–¥–∂–µ—Ä—ã –Ω–µ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞.
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –ª–∏–º–∏—Ç, –∫–æ–º–∏—Å—Å–∏—é –∏ –∞–¥—Ä–µ—Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è —Å—Ä–µ–¥—Å—Ç–≤.
- –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –º–æ–∂–Ω–æ –æ—Ç–æ–∑–≤–∞—Ç—å —á–µ—Ä–µ–∑ `approve(0)`.

---

## ‚öôÔ∏è –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

- –ö–æ–º–∏—Å—Å–∏—è (`feePercent`) —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∞ –ø—Ä–∏ –¥–µ–ø–ª–æ–µ –∏ –∏–∑–º–µ–Ω–∏—Ç—å –µ—ë –Ω–µ–ª—å–∑—è.
- –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –∫–æ–º–∏—Å—Å–∏–∏ –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —á–µ—Ä–µ–∑ `FEEMANAGER_ROLE`, –Ω–æ —Ç–æ–ª—å–∫–æ –Ω–∏–∂–µ –∏–ª–∏ —Ä–∞–≤–Ω—ã–µ –≥–ª–æ–±–∞–ª—å–Ω–æ–π.
- –ú–µ–Ω–µ–¥–∂–µ—Ä—ã –Ω–µ –º–æ–≥—É—Ç —Å–º–µ–Ω–∏—Ç—å –∞–¥—Ä–µ—Å –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ä–µ–¥—Å—Ç–≤ ‚Äî –æ–Ω –∂—ë—Å—Ç–∫–æ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω.

---

## üìä –ê—É–¥–∏—Ç –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å

- –í—Å–µ —Å–ø–∏—Å–∞–Ω–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è (`Withdrawal`, `DetailedWithdrawal`).
- –î–æ—Å—Ç—É–ø–µ–Ω –∂—É—Ä–Ω–∞–ª `getWithdrawalHistory(address)` –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π.
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∑–∞–ø—Ä–æ—Å–∏—Ç—å —Å–≤–æ—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ `getClientFullInfo()`.

---

## üí° –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ö–æ–Ω—Ç—Ä–∞–∫—Ç –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω—ã–π —Å–ø–æ—Å–æ–± –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π, —Å–æ—Ö—Ä–∞–Ω—è—è –ø—Ä–∏ —ç—Ç–æ–º –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –∑–∞ —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏ —É –∫–ª–∏–µ–Ω—Ç–∞.

- –ù–∏–∫–∞–∫–∏–µ —Å—Ä–µ–¥—Å—Ç–≤–∞ –Ω–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ.
- –°–ø–∏—Å–∞–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –≤ —Ä–∞–º–∫–∞—Ö –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã—Ö –ª–∏–º–∏—Ç–æ–≤ –∏ –∫–æ–º–∏—Å—Å–∏–π.
- –ü–∞—Ä—Ç–Ω—ë—Ä—ã –º–æ–≥—É—Ç –±—ã—Ç—å —É–≤–µ—Ä–µ–Ω—ã –≤ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ —Ä–∞—Å—á—ë—Ç–æ–≤.
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ ‚Äî –≤ –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏ –∏ –∫–æ–Ω—Ç—Ä–æ–ª–µ —Å–≤–æ–∏—Ö —Å—Ä–µ–¥—Å—Ç–≤.

SettlementAgent ‚Äî —ç—Ç–æ –¥–æ–≤–µ—Ä–∏–µ, –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏.
---

## üß™ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### üõç –°—Ü–µ–Ω–∞—Ä–∏–π 1: –û–ø–ª–∞—Ç–∞ —Å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –∫–∞—Ä—Ç—ã Simple

**–ö–æ–Ω—Ç–µ–∫—Å—Ç:**  
–ö–ª–∏–µ–Ω—Ç —Ö—Ä–∞–Ω–∏—Ç —Å—Ä–µ–¥—Å—Ç–≤–∞ –≤ USDC –Ω–∞ —Å–≤–æ—ë–º –∫–æ—à–µ–ª—å–∫–µ. –ö–æ–º–ø–∞–Ω–∏—è Simple –≤—ã–ø—É—Å–∫–∞–µ—Ç –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –∫–∞—Ä—Ç—É VISA, –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—É—é –∫ –∞–¥—Ä–µ—Å—É –∫–ª–∏–µ–Ω—Ç–∞.

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ–ø–ª–∞—Ç–∞:**

1. –ö–ª–∏–µ–Ω—Ç –≤—ã–∑—ã–≤–∞–µ—Ç `approve(contract, 1000 USDC)` –Ω–∞ –∞–¥—Ä–µ—Å –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ SettlementAgent.
2. –ó–∞—Ç–µ–º –≤—ã–∑—ã–≤–∞–µ—Ç `allowLimit()`, —á—Ç–æ–±—ã –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –ª–∏–º–∏—Ç –∏ —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞.
3. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ª–∏–º–∏—Ç—ã —Å–ø–∏—Å–∞–Ω–∏–π: `setTimeLimits(200 USDC / 10 –º–∏–Ω, 500 USDC / 24 —á)`
4. –ü—Ä–∏ –æ–ø–ª–∞—Ç–µ —Ç–æ–≤–∞—Ä–∞ —á–µ—Ä–µ–∑ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –∫–∞—Ä—Ç—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ –º–∞–≥–∞–∑–∏–Ω–µ) –º–µ–Ω–µ–¥–∂–µ—Ä Simple –≤—ã–∑—ã–≤–∞–µ—Ç `withdrawFromClient(...)`.
5. –ö–æ–Ω—Ç—Ä–∞–∫—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
   - –≤–µ—Ä—Å–∏—é –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞, —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—É—é –∫–ª–∏–µ–Ω—Ç–æ–º;
   - –Ω–µ –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏ –ª–∏–º–∏—Ç;
   - —Ö–≤–∞—Ç–∞–µ—Ç –ª–∏ approve –∏ –±–∞–ª–∞–Ω—Å–∞;
   - —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª–∏ –∫–æ–º–∏—Å—Å–∏—è –ø—Ä–∞–≤–∏–ª–∞–º.
6. –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–ø–∏—Å–∞–Ω–∏–µ:
   - –æ—Å–Ω–æ–≤–Ω–∞—è —Å—É–º–º–∞ –Ω–∞ settlement-–∞–¥—Ä–µ—Å;
   - –∫–æ–º–∏—Å—Å–∏—è ‚Äî –Ω–∞ fee-–∞–¥—Ä–µ—Å.
7. –ö–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—é —á–µ—Ä–µ–∑ `getWithdrawalHistory(...)`.

---

### üéØ –°—Ü–µ–Ω–∞—Ä–∏–π 2: –û—Ç–∑—ã–≤ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π

–ö–ª–∏–µ–Ω—Ç –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç –º–æ–∂–µ—Ç:

- –≤—ã–∑–≤–∞—Ç—å `approve(contract, 0)` ‚Äî –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–æ–∑–≤–∞—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ —Å–ø–∏—Å—ã–≤–∞—Ç—å —Å—Ä–µ–¥—Å—Ç–≤–∞;
- –∏–∑–º–µ–Ω–∏—Ç—å –ª–∏–º–∏—Ç—ã;
- –ø–æ–ª—É—á–∏—Ç—å –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é —á–µ—Ä–µ–∑ `getClientFullInfo(...)`.

---

### üõ° –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ö–æ–Ω—Ç—Ä–∞–∫—Ç –Ω–µ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Å—Ä–µ–¥—Å—Ç–≤–∞–º –±–µ–∑ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è.
- –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ø—Ä–æ–∑—Ä–∞—á–Ω—ã, –ª–∏–º–∏—Ç—ã ‚Äî –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞.
- Settlement-–∞–¥—Ä–µ—Å –∑–∞—à–∏—Ç –ø—Ä–∏ –¥–µ–ø–ª–æ–µ ‚Äî –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–¥–º–µ–Ω—ë–Ω.
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Å–ø–∏—Å–∞—Ç—å —Å—Ä–µ–¥—Å—Ç–≤–∞ –≤ –æ–±—Ö–æ–¥ –ª–∏–º–∏—Ç–æ–≤ –∏–ª–∏ –Ω–∞ –¥—Ä—É–≥–æ–π –∞–¥—Ä–µ—Å.
